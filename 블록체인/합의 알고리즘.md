- 규칙을 따르는 매커니즘
- 규칙을 준수하여  원하는 결과를 얻기 위한 절차를 지시
- 서명 및 잔고 등 검증
- 트랜잭션을 합의하고 승인
- 블록의 유효성을 검사

이중 지불 문제에 대해서 거부 할 수 있음

> 비잔틴 장군 문제 (BFT, Byzantine General Problem / Byzantine Fault)
> 비잔틴 제국에 두 명 이상의 장군들이 적을 공격하는 것이 아닌 배신자로 인해 공격에 실패함. 
> - 정보에서 과반이상의 문제를 가지는 사용자가 시스템에 문제를 일으키는 것

> 비잔틴 문제 해결
> f = 배신한 장군의 수 
> n : 장군의 수 
> N : 비잔틴 문제를 해결하는데 필요한 장군의 수 
> (n-1)/3 개의 노드의 공격을 방어함 (N = 3f + 1)
>

## BFT 기반 알고리즘 
- 다수결(전체의 51%)에 의한 검증으로 합의를 보장
	- PoW, PoS, DPoS
	-  절반 만 넘으면 데이터를 인정해줌
- 악의를 가진 노드의 일부를 허용(1/3)하여 네트워크 합의를 보장
	- PBFT, RAFT

### PoW(Proof of Work)
- 컴퓨팅 파워를 이용하여 특정 난이도의 해시값을 이용하여 넌스값을 계산하고 검증
- 블록체인 자료구조 : linked list
- 앞의 블록과 뒤의 블록이 연결
- 블록마다 고유 해시값 가짐
- 채굴
	- 전체 사용자가 넌스값을 찾는 수학적 퍼즐 해결 기회를 가짐
	- 수학적 퍼즐을 맞춘 사용자가 새 블록 합의의 권한을 가짐
	- 여러 사용자가 동시에 푼 경우 더 긴 체인을 가진 사용자의 블록을 선택
		- 선택되지 않은 블록을 고아블록이라고 함
		- 고아블록을 기준으로 새로운 블록체인을 형성하는 Fork를 만들기도 함
	- 과도한 CPU연산 능력 필요


### PoS(Proof of Stake)
- 기존의 컴퓨팅 파워 낭비문제를 해결하기 위해 노드가 보유한 자산을 기준으로 권한 분배 및 합의도출하여 보상
- 지분 증명 방식
- 자신이 보유한 지분을 보증금의 형태로 증명
- 위험
	- 51% 공격의 위험 
	- Nothing at Stake 문제 발생
		- 잘 못된 노드에 투표하여 다른 사람이 보상을 받는 것을 방해함.
- 장점
	- 컴퓨팅 파워 절약
	- 자신 지분을 담보로 합의해서 덤핑 방지
- 단점
	- 51% 문제 
	- Nothing at Stake 발생


### DPoS (Delegated Proof of Stake)
- 지분을 가진 사람 중 투표로 선출된 특정 인원에게 권한을 위임
- 장점
	- 소규모 참여로 합의 속도 빠름
- 단점
	- 일부 노드가 권한을 위임하여 합의함으로 탈중앙화의 원칙에 문제가 있음

### PBFT
- 분산시스템에서 비잔틴 노드가 존재할 수 있는 경우에도 합의가 가능한 알고리즘
- 합의 과정
	- 클라이언트 : 메시지 전달 요청
	- 리더가 클라이언트의 요청을 수집하여 나머지 노드에게 메시지 전달
	- 리더의 메시지를 받은  각 노드들은 다른 노드들에게 검증 메시지를 보냄
		- 각 노드가 수집한 Pre-prepare 메시지의 수가 2f+1이고
		- 각 노드가 수집한 Prepare 메시지가 2f 이상인 경우 
		- prepare certificate
	- commit
	- reply

